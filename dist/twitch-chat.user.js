// ==UserScript==
// @name        twitch-chat
// @version     2.2.2
// @description extensions for chat styling
// @license     MIT
// @match       https://www.twitch.tv/*
// @grant       GM_addStyle
// ==/UserScript==

(function(){"use strict";const u=(t,n)=>{var o;const a=(o=n?.timeCheckUrl)!=null?o:500;let e="";setInterval(()=>{const r=window.location.href;r!==e&&(e=r,t())},a)},i=(t,n)=>{var o;const a=(o=n?.timeDisconnect)!=null?o:1e4;return new Promise(e=>{const r=document.querySelector(t);if(r)return e(r);const s=new MutationObserver(p=>{const d=document.querySelector(t);d&&(e(d),s.disconnect())});setTimeout(()=>{document.querySelector(t)||s.disconnect()},a),s.observe(document.body,{childList:!0,subtree:!0})})},m=`.chat-line__username{padding:1px 6px;border:2px solid #fff;border-radius:50px!important;margin-right:5px}.chat-line__message span[aria-hidden=true]{display:none}
`,_=`.chat-line__username{padding:1px 6px;border:2px solid #fff;border-radius:50px!important;margin-right:5px;border-color:inherit}.chat-line__username:hover{text-decoration:none!important}.chat-line__message--badges span{border-radius:50px!important;padding:12px}.chat-line__message span[aria-hidden=true]{display:none}.chat-line__message .ffz-badge{background-repeat:no-repeat;margin-right:6px!important;border:1px solid transparent}.ffz-emote{margin-top:2px}
`;let c=!1;i("#ffz-script").then(()=>{c=!0});const l=t=>{const n=t.querySelector(c?".chat-line__username":".chat-author__display-name");if(!n)return;const o=getComputedStyle(n).color;t.querySelectorAll(".text-fragment").forEach(e=>e.style.color=o),t.querySelectorAll(c?".chat-line__message-mention ":".mention-fragment").forEach(e=>e.style.color=o);const a=!!t.querySelector("br");if(c){a||n.after(document.createElement("br"));const e=t.querySelector(".chat-line__message--badges");if(e){for(const r of e.children)r instanceof HTMLElement&&(r.style.borderColor=o);n.after(e)}}else{const e=t.querySelector(".chat-line__username-container");a||e==null||e.after(document.createElement("br"));const r=e?.querySelector(".chat-line__username");r&&(r.style.borderColor=o);const s=e?.children[0];s&&r?.after(s)}};u(async()=>{const t=await i(".chat-scrollable-area__message-container");new MutationObserver(n=>{c?GM_addStyle(_):GM_addStyle(m);for(const o of n){const a=o.addedNodes[0];a instanceof HTMLElement&&(a.classList.contains("chat-line__message")||a.classList.contains("chat-line__message-container"))&&l(a)}}).observe(t,{childList:!0,subtree:!0})}),window.addEventListener("click",async()=>{await i(".chat-input-tray__open .chat-line__message");const t=document.querySelectorAll(".chat-input-tray__open .chat-line__message");for(const n of t)l(n)})})();
