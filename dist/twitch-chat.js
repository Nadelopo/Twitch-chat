(function(){"use strict";const f=t=>{let n=window.location.href;t(),navigation.addEventListener("navigate",o=>{n!==o.destination.url&&(t(),n=o.destination.url)})};function h(t,n,o){const r=new MutationObserver((e,a)=>{for(const c of e)n(c,a)});return r.observe(t,{childList:!0,subtree:!0,...o}),()=>r.disconnect()}function i({selector:t,target:n=document.body,rejectTimeoutMs:o,signal:r}){return new Promise((e,a)=>{const c=h(n,(m,p)=>{const _=n.querySelector(t);_&&(p.disconnect(),e(_))}),s={timeout:null,abort:null},u=m=>{s.timeout&&clearTimeout(s.timeout),s.abort&&r.removeEventListener("abort",s.abort),c(),a(m)};o>0&&(s.timeout=setTimeout(()=>u(`${i.name} rejected (${o}ms)`),o)),r&&!r.aborted&&(s.abort=()=>u(r.reason),r.addEventListener("abort",s.abort))})}const b=`.chat-line__username{padding:1px 6px;border:2px solid #fff;border-radius:50px!important;margin-right:5px;border-color:inherit}.chat-line__message span[aria-hidden=true]{display:none}
`,g=`.chat-line__username:hover{text-decoration:none!important}.chat-line__message--badges span{border-radius:50px!important;padding:12px}.chat-line__message .ffz-badge{background-repeat:no-repeat;margin-right:6px!important;border:1px solid transparent}.ffz-emote{margin-top:2px}
`;GM_addStyle(b);let l=!1;i({selector:"#ffz-script",target:document.head}).then(()=>{l=!0,GM_addStyle(g)});const d=t=>{const n=t.querySelector(l?".chat-line__username":".chat-author__display-name");if(!n)return;const o=getComputedStyle(n).color;t.querySelectorAll(".text-fragment").forEach(e=>e.style.color=o),t.querySelectorAll(l?".chat-line__message-mention ":".mention-fragment").forEach(e=>e.style.color=o);const r=!!t.querySelector("br");if(l){r||n.after(document.createElement("br"));const e=t.querySelector(".chat-line__message--badges");if(e){for(const a of e.children)a instanceof HTMLElement&&(a.style.borderColor=o);n.after(e)}}else{const e=t.querySelector(".chat-line__username-container");r||e==null||e.after(document.createElement("br"));const a=e?.querySelector(".chat-line__username");a&&(a.style.borderColor=o);const c=e?.children[0];c&&a?.after(c)}};f(async()=>{const t=await i({selector:".chat-scrollable-area__message-container"});new MutationObserver(n=>{for(const o of n){const r=o.addedNodes[0];r instanceof HTMLElement&&(r.classList.contains("chat-line__message")||r.classList.contains("chat-line__message-container"))&&d(r)}}).observe(t,{childList:!0,subtree:!0})}),window.addEventListener("click",async()=>{await i({selector:".chat-input-tray__open .chat-line__message"});const t=document.querySelectorAll(".chat-input-tray__open .chat-line__message");for(const n of t)d(n)})})();
