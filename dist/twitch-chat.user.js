// ==UserScript==
// @name        twitch-chat
// @version     2.2.0
// @description extensions for chat styling
// @license     MIT
// @match       https://www.twitch.tv/*
// @grant       GM_addStyle
// ==/UserScript==

(function(){"use strict";const u=(n,a)=>{var t;const c=(t=a?.timeCheckUrl)!=null?t:500;let o="";setInterval(()=>{const e=window.location.href;e!==o&&(o=e,n())},c)},i=(n,a)=>{var t;const c=(t=a?.timeDisconnect)!=null?t:1e4;return new Promise(o=>{if(document.querySelector(n)){const r=document.querySelector(n);if(r)return o(r)}const e=new MutationObserver(r=>{if(document.querySelector(n)){const s=document.querySelector(n);s&&(o(s),e.disconnect())}});setTimeout(()=>{document.querySelector(n)||e.disconnect()},c),e.observe(document.body,{childList:!0,subtree:!0})})},m=`.chat-line__username{padding:1px 6px;border:2px solid #fff;border-radius:50px!important;margin-right:5px}.chat-line__message span[aria-hidden=true]{display:none}
`,_=`.chat-line__username{padding:1px 6px;border:2px solid #fff;border-radius:50px!important;margin-right:5px;border-color:inherit}.chat-line__username:hover{text-decoration:none!important}.chat-line__message--badges span{border-radius:50px!important;padding:12px}.chat-line__message span[aria-hidden=true]{display:none}.chat-line__message .ffz-badge{background-repeat:no-repeat;margin-right:6px!important;border:1px solid transparent}
`;let l=!1;i("#ffz-script").then(()=>{l=!0});const d=n=>{var a;for(const t of n){if(t.classList.contains("message__changed"))continue;t.classList.add("message__changed");const c=t.querySelector(l?".chat-line__username":".chat-author__display-name");if(!c)continue;const o=getComputedStyle(c).color;if(t.querySelectorAll(".text-fragment").forEach(e=>e.style.color=o),l){t.querySelectorAll(".chat-line__message-mention ").forEach(r=>r.style.color=o),t.querySelector("br")||c.insertAdjacentElement("afterend",document.createElement("br"));const e=t.querySelector(".chat-line__message--badges");if(e){for(const r of e.children)r instanceof HTMLElement&&(r.style.borderColor=o);c.insertAdjacentElement("afterend",e)}}else{t.querySelectorAll(".mention-fragment").forEach(h=>h.style.color=o);const e=t.querySelector(".chat-line__username-container");e?.insertAdjacentElement("afterend",document.createElement("br"));const r=e?.querySelector(".chat-line__username");r&&(r.style.borderColor=o);const s=(a=t.querySelector(".chat-line__username-container"))==null?void 0:a.children[0];s&&r?.insertAdjacentElement("afterend",s)}}};u(async()=>{const n=await i(".chat-scrollable-area__message-container");new MutationObserver(()=>{const a=document.querySelectorAll(".chat-line__message");l?GM_addStyle(_):GM_addStyle(m),d(a)}).observe(n,{childList:!0,subtree:!0})}),window.addEventListener("click",async()=>{await i(".chat-input-tray__open .chat-line__message");const n=document.querySelectorAll(".chat-input-tray__open .chat-line__message");d(n)})})();
