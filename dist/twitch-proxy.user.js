// ==UserScript==
// @name     twitch-proxy
// @version  1.0.1
// @license  MIT
// @match    https://www.twitch.tv/*
// @grant    GM_addStyle
// ==/UserScript==

(function(){"use strict";function q(t,e){var r=E(t),i=r.tag,n=r.id,o=r.className,l=e?document.createElementNS(e,i):document.createElement(i);return n&&(l.id=n),o&&(e?l.setAttribute("class",o):l.className=o),l}function E(t){for(var e=t.split(/([.#])/),r="",i="",n=1;n<e.length;n+=2)switch(e[n]){case".":r+=" "+e[n+1];break;case"#":i=e[n+1]}return{className:r.trim(),tag:e[0]||"div",id:i}}function k(t,e,r){var i=e.__redom_lifecycle;if(y(i)){e.__redom_lifecycle={};return}var n=r;for(e.__redom_mounted&&s(e,"onunmount");n;){var o=n.__redom_lifecycle||{};for(var l in i)o[l]&&(o[l]-=i[l]);y(o)&&(n.__redom_lifecycle=null),n=n.parentNode}}function y(t){if(t==null)return!0;for(var e in t)if(t[e])return!1;return!0}var A=["onmount","onremount","onunmount"],T=typeof window<"u"&&"ShadowRoot"in window;function h(t,e,r,i){var n=f(t),o=f(e);e===o&&o.__redom_view&&(e=o.__redom_view),e!==o&&(o.__redom_view=e);var l=o.__redom_mounted,a=o.parentNode;if(l&&a!==n&&k(e,o,a),r!=null)if(i){var c=f(r);c.__redom_mounted&&s(c,"onunmount"),n.replaceChild(o,c)}else n.insertBefore(o,f(r));else n.appendChild(o);return j(e,o,n,a),e}function s(t,e){e==="onmount"||e==="onremount"?t.__redom_mounted=!0:e==="onunmount"&&(t.__redom_mounted=!1);var r=t.__redom_lifecycle;if(r){var i=t.__redom_view,n=0;i&&i[e]&&i[e]();for(var o in r)o&&n++;if(n)for(var l=t.firstChild;l;){var a=l.nextSibling;s(l,e),l=a}}}function j(t,e,r,i){for(var n=e.__redom_lifecycle||(e.__redom_lifecycle={}),o=r===i,l=!1,a=0,c=A;a<c.length;a+=1){var u=c[a];o||t!==e&&u in t&&(n[u]=(n[u]||0)+1),n[u]&&(l=!0)}if(!l){e.__redom_lifecycle={};return}var d=r,_=!1;for((o||d&&d.__redom_mounted)&&(s(e,o?"onremount":"onmount"),_=!0);d;){var v=d.parentNode,x=d.__redom_lifecycle||(d.__redom_lifecycle={});for(var p in n)x[p]=(x[p]||0)+n[p];if(_)break;(d.nodeType===Node.DOCUMENT_NODE||T&&d instanceof ShadowRoot||v&&v.__redom_mounted)&&(s(d,o?"onremount":"onmount"),_=!0),d=v}}function I(t,e,r){var i=f(t);if(typeof e=="object")for(var n in e)w(i,n,e[n]);else w(i,e,r)}function w(t,e,r){t.style[e]=r??""}var g="http://www.w3.org/1999/xlink";function b(t,e,r,i){var n=f(t),o=typeof e=="object";if(o)for(var l in e)b(n,l,e[l],i);else{var a=n instanceof SVGElement,c=typeof r=="function";if(e==="style"&&typeof r=="object")I(n,r);else if(a&&c)n[e]=r;else if(e==="dataset")C(n,r);else if(!a&&(e in n||c)&&e!=="list")n[e]=r;else{if(a&&e==="xlink"){S(n,r);return}i&&e==="class"&&(r=n.className+" "+r),r==null?n.removeAttribute(e):n.setAttribute(e,r)}}}function S(t,e,r){if(typeof e=="object")for(var i in e)S(t,i,e[i]);else r!=null?t.setAttributeNS(g,e,r):t.removeAttributeNS(g,e,r)}function C(t,e,r){if(typeof e=="object")for(var i in e)C(t,i,e[i]);else r!=null?t.dataset[e]=r:delete t.dataset[e]}function L(t){return document.createTextNode(t??"")}function N(t,e,r){for(var i=0,n=e;i<n.length;i+=1){var o=n[i];if(!(o!==0&&!o)){var l=typeof o;l==="function"?o(t):l==="string"||l==="number"?t.appendChild(L(o)):M(f(o))?h(t,o):o.length?N(t,o,r):l==="object"&&b(t,o,null,r)}}}function f(t){return t.nodeType&&t||!t.el&&t||f(t.el)}function M(t){return t&&t.nodeType}function m(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var i,n=typeof t;if(n==="string")i=q(t);else if(n==="function"){var o=t;i=new(Function.prototype.bind.apply(o,[null].concat(e)))}else throw new Error("At least one argument required");return N(f(i),e,!0),i}var O=m;m.extend=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return m.bind.apply(m,[this].concat(t))};const D=`.chat-line__username-container{padding:1px 6px;border:2px solid #fff;border-radius:50px!important;margin-right:5px}span[data-test-selector=chat-message-separator]{display:none}.chat-badge{border-radius:8px!important}
`;GM_addStyle(D);const R=()=>{let t=0;const e=n=>{const o=n.querySelector(".chat-author__display-name");let l=null;o&&(l=window.getComputedStyle(o).color);let a=n.querySelector(".chat-line__username-container");a&&window.getComputedStyle(a).borderColor!==l&&l&&(a.style.borderColor=l);let c;setTimeout(()=>{c=n.lastElementChild,c&&window.getComputedStyle(c).color!==l&&l&&(c.style.color=l)});let u=n.querySelector(".seventv-mention");u||(u=n.querySelector(".mention-fragment")),u&&window.getComputedStyle(u).color!==l&&l&&(u.style.color=l),t&&setTimeout(()=>{c&&window.getComputedStyle(c).color===l&&(clearInterval(t),t=0)},5e3)},r=()=>{document.querySelectorAll(".chat-line__no-background").forEach(n=>e(n))};let i="";setInterval(()=>{const n=window.location.href;if(n!==i){i=n;let o=document.querySelector(".chat-scrollable-area__message-container"),l=new MutationObserver(()=>r());t=setInterval(()=>r(),500),l.observe(o,{childList:!0})}},500),addEventListener("click",()=>{const n=document.querySelector(".chat-input-tray__open");if(n){const o=n.querySelector(".chat-line__no-background");e(o)}})},B=O("div");window.addEventListener("load",()=>{const t=document.querySelector(".stream-chat-header");t&&h(t,B),R()})})();
